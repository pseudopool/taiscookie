---
title: "데이터 상태의 평화를 위한 React Query 🕊"
excerpt: "데이터 상태 컨트롤부터 유저 행동에 따른 데이터 업데이트까지, 리액트 쿼리 도입기"
coverImage: "/assets/posts/react-query-for-peace/cover.png"
date: "2022-10-11T05:35:07.322Z"
ogImage:
  url: "/assets/posts/react-query-for-peace/cover.png"
---

# 🛠 React Query로 데이터 상태 제어하기

백엔드 개발자들과 협업 프로젝트를 진행하면서 서버가 보내준 데이터를 가공하는 코드가 상당히 많아졌다. 계속해서 서버에 API 요청을 보내고, 응답을 받고, 특정 변수에 응답 데이터를 담고, 그 변수를 데이터가 필요한 컴포넌트에 props로 내려주게 됐다.

변수를 선언하고 요청을 보낸다고 바로 데이터가 할당 되는 것이 아니기 때문에, 서버 응답 데이터를 담는 변수는 언제나 상태를 가지게 된다. 요청이 성공하거나, 실패하거나, 혹은 아직 응답이 오지 않아 로딩 중일 수도 있다.

클라이언트에서는 사용자 경험을 향상 시키기 위해 바로 이 데이터 상태에 따라 아래처럼 다른 UI를 보여주고 싶은 게 일반적이다.

- 로딩 중 : 컴포넌트의 윤곽만 보여주는 스켈레톤 UI
- 성공 : 데이터가 반영된 정상 UI
- 에러 : 에러 문구가 담긴 에러 UI
- 성공이지만 데이터가 0개 : 데이터 등록을 유도하는 UI

## 🫥 기존 방식

이전에는 이렇게 데이터의 상태에 따라 다른 컴포넌트를 보여주고 싶은 경우 아래처럼 리턴문에 삼항 연산자를 작성해주었다.

```javascript
{
  data ? <Normal data={data} /> : <Loading />;
}
```

이렇게 하면 데이터가 참일 경우(정상 응답일 경우) Normal 컴포넌트를, 거짓일 경우(undefined, null, error...) Loading 컴포넌트를 보여줄 수 있었다.

하지만 앞서 말했 듯 데이터의 상태는 다양하고, 각 상태마다 다른 UI를 보여주고 싶었기에 데이터를 참/거짓 두 가지 상태로만 나누는 것은

- 의도에 부합하지 않았고,
- 다른 상태들을 제어하느라 코드가 지저분해지기도 했고,
- 가독성이 떨어졌다.

## 🪡 리액트 쿼리 도입 이후

그래서 이번 프로젝트에서는 데이터 상태 관리를 위해 리액트 쿼리를 도입하게 됐다. API 요청 시 리액트 쿼리를 사용하면 데이터의 상태가 객체로 담기게 된다.

- 로딩 중일 때 로딩 컴포넌트 보여주기

```javascript
{
  data.isLoading && <Loading />;
}
```

- 에러 응답일 때 에러 컴포넌트 보여주기

```javascript
{
  data.isError && <Error />;
}
```

- 정상 응답일 때 데이터 내리기

```javascript
{
  data.isSuccess && <Normal data={data} />;
}
```

코드도 훨씬 깔끔해지고, 직관적으로 어느 컴포넌트가 어느 상태에 보여지는지 확인할 수 있어 가독성도 높아졌다.

## 🪄 데이터 요청도 간편하게

뿐만 아니라, 리액트 쿼리로 받아온 데이터에는 refetch 메소드도 들어있어서 해당 데이터를 다시 요청하고 싶을 때 유용하다. 이번 프로젝트는 동네 강아지 산책 모임을 만들고 참여하는 것이 주된 기능이었기 때문에, 산책 모임 조회에서 refetch 메소드를 잘 사용할 수 있었다.

- 유저가 검색할 때
- 위치를 변경할 때

위처럼 유저가 특정 행동을 할 때, 아래처럼 refetch 메소드로 데이터를 업데이트 할 수 있다.

```javascript
useEffect(() => {
  data.refetch();
}, [query]);
```

페이지를 리로드 하거나 서버에 get 요청을 하는 코드를 다시 작성했던 기존의 방식과 비교했을 때 확연히 간단하게 새로운 데이터를 불러올 수 있었다.

---

이번 프로젝트에서는 React Query의 데이터 상태 관리 기능을 잘 썼지만, 이밖에도 React Query는 API 데이터를 처리할 때의 성가신 문제들을 상당 부분 해결해준다. React Query의 다양한 기술을 많이 접목하지 못해서 아쉬운 부분이 있었기에 조금 더 공부한 후 기존 프로젝트들을 리팩토링 해보고 싶다.
